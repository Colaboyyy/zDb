# zdb
一个用go语言实现的简单k-v存储模型

不管是插入、查询、删除，都只有两个步骤：一次内存中的索引更新，一次磁盘文件的记录追加。
___
## 存储模型

Entry结构定义

| key | value | keySize | valueSize | method |

一个数据文件zdb.data是多个Entry的集合

## 操作
### GET
获取数据：读取磁盘文件zdb.data的Entry记录到内存，在内存中的哈希表查找key的索引offset，然后从磁盘中读取数据

### PUT
存放数据：将key、value根据Entry的结构封装成一条Entry记录，然后以追加的方式添加到磁盘文件zdb.data中，标记位为PUT。

### DEL
删除数据：跟PUT操作一致，并不是直接定位原数据进行删除，而是将需要删除的key封装成Entry记录，标记位为DEL，追加到磁盘文件中。
然后在内存中删除哈希表对应key的索引信息。

### Merge
整合数据：**最重要的操作** ，PUT和DEL都会对磁盘文件追加写入，这会导致文件容量一直增加，对于同一个key会在文件中存在多条Entry记录。

*需要定期整合数据文件，清理无效的Entry数据。*

#### 操作：

1、读取数据文件的Entry记录，与内存中的索引（最新）进行比较，找出有效的Entry。

2、将有效的Entry写到新的临时文件中。

3、删除旧的数据文件，将临时文件改名。